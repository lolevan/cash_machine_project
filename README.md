# Cash Machine API

Этот проект представляет собой реализацию "кассового аппарата" для вымышленного магазина с использованием Python 3, Django, Django REST Framework и Jinja2. Проект позволяет создавать чеки в формате PDF и генерировать QR-коды, которые ссылаются на эти чеки.

## Выполненные задачи

### Этап 1: Моделирование данных и генерация чека

1. **Создание модели данных для товара `Item`**:

2. **Создание API для обработки POST-запросов**:
    - API принимает POST-запрос на веб-узел `/cash_machine/` с телом запроса:
      ```json
      {
          "items": [1, 2, 3]
      }
      ```
    - `items` — это массив `id` товаров, которые будут включены в чек.

3. **Генерация чека в формате PDF**:

4. **Генерация QR-кода**:
    - Сервер генерирует QR-код, который содержит ссылку на PDF-файл с чеком.
    - QR-код также сохраняется в папку `media`.

5. **Отправка ссылки на QR-код в ответе**:
    - В ответе на POST-запрос сервер возвращает полный URL для доступа к QR-коду, например:
      ```json
      {
          "qr_code_url": "http://192.168.0.104:8000/media/qrcode_20.08.2024_08-30.png"
      }
      ```

### Этап 2: Доступ к PDF-файлу по QR-коду

1. **Обработка GET-запроса по ссылке из QR-кода**:
    - При сканировании QR-кода выполняется запрос на сервер по пути `/media/<наименование файла>`.
    - Сервер возвращает PDF-файл с чеком, который можно просмотреть или скачать.

2. **Тестирование решения в локальной сети**:
    - В целях тестирования сервер был запущен в локальной сети с указанным IP-адресом.
    - Это позволяет сканировать QR-код через мобильные устройства и проверять доступ к чекам.

### Дополнительные задачи

1. **Использование переменной окружения для пути к wkhtmltopdf**:
    - Чтобы избежать жесткой привязки пути к `wkhtmltopdf`, использована переменная окружения `WKHTMLTOPDF_PATH`.
    - Путь к `wkhtmltopdf` теперь можно задавать через настройки системы, что делает решение более гибким.

2. **Создание команды для генерации тестовых данных**:
    - В проект добавлена management-команда для генерации 5 случайных продуктов в базе данных.
    - Команда выполняется с помощью `python manage.py generate_products`.

## Установка

### 1. Клонирование репозитория

Склонируйте репозиторий на вашу локальную машину:

```bash
git clone https://github.com/lolevan/cash_machine_project.git
cd cash_machine_project
```
### 2. Создайте виртуальное окружение и активируйте его:

```bash
python -m venv venv
source venv/bin/activate   # Для Windows используйте `venv\Scripts\activate`
```

### 3. Установите зависимости:

```bash
pip install -r requirements.txt
```
### 4. Установка wkhtmltopdf:
Для корректной работы генерации PDF необходимо установить wkhtmltopdf.

Debian/Ubuntu:
```bash
sudo apt-get install wkhtmltopdf
```
macOS:
```bash
brew install homebrew/cask/wkhtmltopdf
```

### 5. Настройка wkhtmltopdf через .env файл:
Чтобы ваш проект корректно использовал wkhtmltopdf, необходимо добавить путь к исполняемому файлу в переменную окружения WKHTMLTOPDF_PATH через .env файл. Это позволит динамически задавать путь и избежать жесткой привязки в коде.

```bash
WKHTMLTOPDF_PATH=YOUR_PATH
```
Убедитесь, что путь к wkhtmltopdf соответствует месту его установки на вашей системе.
По дефолту установлено **/usr/local/bin/wkhtmltopdf**

### 6. Примените миграции:

```bash
python manage.py migrate
```

### 7. Заполните базу данных тестовыми данными:

```bash
python manage.py generate_products
```

### 8. Запустите сервер разработки:

```bash
python manage.py runserver
```
или если тестите через телефон указывайте IP-адрес вашей машины в локальной сети
например:
```bash
python manage.py runserver 192.168.0.1:8000
```

## Использование

### 1. Создание чека

Для создания чека и получения QR-кода, выполните POST-запрос на конечную точку `/cash_machine/`.

#### Пример запроса с использованием cURL:

```bash
curl -X POST http://localhost:8000/cash_machine/ \
-H "Content-Type: application/json" \
-d '{"items": [1, 2]}'
```
- `items` — это массив `id` товаров, которые будут включены в чек.

#### Пример ответа

```json
  {
      "qr_code_url": "http://192.168.0.104:8000/media/qrcode_20.08.2024_08-30.png"
  }
  ```
- `qr_code_url` - Полный URL-адрес, по которому можно скачать QR-код, содержащий ссылку на PDF-файл с чеком.
